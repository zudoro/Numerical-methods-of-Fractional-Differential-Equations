MODULE PU_1D

	USE GLBVAR
	USE PATCH_MAPPING

	IMPLICIT INTEGER (I-N)
	IMPLICIT REAL(8) (A-H,O-Z)

CONTAINS

!--------------------------PHYSICAL PU-1D-----------------------------

TYPE(FUNCTION_1D) FUNCTION PHYPU1D(PHYX, PATCH)

    REAL*8, INTENT(IN) :: PHYX	
    INTEGER, INTENT(IN) :: PATCH
    TYPE(FUNCTION_1D) :: PUMAP

    PUMAP = PATCH_TO_REFPU(PHYX, PATCH)
		
		PHYPU1D%VAL(0) = PU1D(PUMAP%VAL(0), 0)
		PHYPU1D%VAL(1) = PU1D(PUMAP%VAL(0), 1)*PUMAP%VAL(1)
		PHYPU1D%VAL(2) = PU1D(PUMAP%VAL(0), 2)*(PUMAP%VAL(1))**2 !+ PU1D(PUMAP%VAL(0), 1)*PUMAP%VAL(2)

END FUNCTION PHYPU1D

REAL*8 FUNCTION PU1D(X, FLAGX)

	REAL*8, INTENT(IN) :: X
	INTEGER, INTENT(IN) :: FLAGX

	IF (FLAGX.EQ. 0) THEN													! PU-FUNCTION
		IF ((X + 1.0D0 .GE. EPS) .AND. (X .LT. EPS)) THEN
			IF (PUORDER.EQ.1) THEN
				PU1D=(1.0D0+X)
			ELSEIF (PUORDER.EQ.2) THEN
				PU1D=((1.0D0+X)**2)*(1.0D0-2.0D0*X)
			ELSEIF (PUORDER.EQ.3) THEN
				PU1D=((1.0D0+X)**3)*(1.0D0-3.0D0*X+6.0D0*X**2)
			ELSEIF (PUORDER.EQ.4) THEN
				PU1D=((1.0D0+X)**4)*(1.0D0-4.0D0*X+10.0D0*X**2-20.0D0*X**3)
			ELSEIF (PUORDER.EQ.5) THEN
				PU1D=((1.0D0+X)**5)*(1.0D0-5.0D0*X+15.0D0*X**2-35.0D0*X**3+70.0D0*X**4)
			ELSEIF (PUORDER.EQ.6) THEN
				PU1D=((1.0D0+X)**6.0D0)*(1.0D0-6.0D0*X+21.0D0*X**2.0D0-56.0D0*X**3.0D0+126.0D0*X**4.0D0 &
				-252.0D0*X**5.0D0)
			ELSEIF (PUORDER.EQ.7) THEN
				PU1D=((1.0D0+X)**7)*(1.0D0-7.0D0*X+28.0D0*X**2-84.0D0*X**3+210.0D0*X**4-462.0D0*X**5 &
				+924.0D0*X**6)
			ENDIF
		ELSEIF ((X .GE. EPS) .AND. (X - 1.0D0 .LT. EPS)) THEN
			IF (PUORDER.EQ.1) THEN
				PU1D=(1.0D0-X)
			ELSEIF (PUORDER.EQ.2) THEN
				PU1D=((1.0D0-X)**2)*(1.0D0+2.0D0*X)
			ELSEIF (PUORDER.EQ.3) THEN
				PU1D=((1.0D0-X)**3)*(1.0D0+3.0D0*X+6.0D0*X**2)
			ELSEIF (PUORDER.EQ.4) THEN
				PU1D=((1.0D0-X)**4)*(1.0D0+4.0D0*X+10.0D0*X**2+20.0D0*X**3)
			ELSEIF (PUORDER.EQ.5) THEN
				PU1D=((1.0D0-X)**5)*(1.0D0+5.0D0*X+15.0D0*X**2.0D0+35.0D0*X**3.0D0+70.0D0*X**4)
			ELSEIF (PUORDER.EQ.6) THEN
				PU1D=((1.0D0-X)**6)*(1.0D0+6.0D0*X+21.0D0*X**2+56.0D0*X**3+126.0D0*X**4+252.0D0*X**5)
			ELSEIF (PUORDER.EQ.7) THEN
				PU1D=((1.0D0-X)**7)*(1.0D0+7.0D0*X+28.0D0*X**2+84.0D0*X**3+210.0D0*X**4+462.0D0*X**5 &
				+924.0D0*X**6)
			ENDIF
		ELSE
			PU1D=0.0D0
		ENDIF
	ELSEIF (FLAGX.EQ.1) THEN												! DIFFERENTIATION OF PU-FUNCTION
		IF ((X + 1.0D0 .GE. EPS) .AND. (X .LT. EPS)) THEN
			IF (PUORDER.EQ.1) THEN
				PU1D=1.0D0
			ELSEIF (PUORDER.EQ.2) THEN
				PU1D=-6.0D0*X*(1.0D0 + X)
			ELSEIF (PUORDER.EQ.3) THEN
				PU1D=30.0D0*X**2*(1.0D0 + X)**2
			ELSEIF (PUORDER.EQ.4) THEN
				PU1D=-140.0D0*X**3*(1.0D0 + X)**3
			ELSEIF (PUORDER.EQ.5) THEN
				PU1D=630.0D0*X**4*(1.0D0 + X)**4
			ELSEIF (PUORDER.EQ.6) THEN
				PU1D=-2772.0D0*X**5*(1.0D0 + X)**5
			ELSEIF (PUORDER.EQ.7) THEN
				PU1D=12012.0D0*X**6*(1.0D0 + X)**6
			ENDIF
		ELSEIF ((X .GT. EPS) .AND. (X - 1.0D0 .LE. EPS)) THEN
			IF (PUORDER.EQ.1) THEN
				PU1D=-1.0D0
			ELSEIF (PUORDER.EQ.2) THEN
				PU1D=6.0D0*(-1.0D0 + X)*X
			ELSEIF (PUORDER.EQ.3) THEN
				PU1D=-30.0D0*(-1.0D0 + X)**2*X**2
			ELSEIF (PUORDER.EQ.4) THEN
				PU1D=140.0D0*(-1.0D0 + X)**3*X**3
			ELSEIF (PUORDER.EQ.5) THEN
				PU1D=-630.0D0*(-1.0D0 + X)**4*X**4
			ELSEIF (PUORDER.EQ.6) THEN
				PU1D=2772.0D0*(-1.0D0 + X)**5*X**5
			ELSEIF (PUORDER.EQ.7) THEN
				PU1D=-12012.0D0*(-1.0D0 + X)**6*X**6
			ENDIF
        ELSE
            PU1D=0.0D0
		ENDIF
	ELSEIF (FLAGX.EQ.2) THEN												! DIFFERENTIATION OF PU-FUNCTION
		IF ((X + 1.0D0 .GE. EPS) .AND. (X .LT. EPS)) THEN
			IF (PUORDER.EQ.1) THEN
				PU1D=0.0D0
			ELSEIF (PUORDER.EQ.2) THEN
				PU1D=-6*x - 6*(1.0D0 + x)
			ELSEIF (PUORDER.EQ.3) THEN
				PU1D=60*x**2*(1.0D0 + X) + 60*x*(1.0D0 + X)**2
			ELSEIF (PUORDER.EQ.4) THEN
				PU1D=-420*x**3*(1.0D0 + X)**2 - 420*x**2*(1.0D0 + X)**3
			ELSEIF (PUORDER.EQ.5) THEN
				PU1D=2520*x**4*(1.0D0 + X)**3 + 2520*x**3*(1.0D0 + X)**4
			ELSEIF (PUORDER.EQ.6) THEN
				PU1D=-13860*x**5*(1.0D0 + X)**4 - 13860*x**4*(1.0D0 + X)**5
			ELSEIF (PUORDER.EQ.7) THEN
				PU1D=72072*x**6*(1.0D0 + X)**5 + 72072*x**5*(1.0D0 + X)**6
			ENDIF
		ELSEIF ((X .GT. EPS) .AND. (X - 1.0D0 .LE. EPS)) THEN
			IF (PUORDER.EQ.1) THEN
				PU1D=0.0D0
			ELSEIF (PUORDER.EQ.2) THEN
				PU1D=6*x + 6*(-1.0D0 + X)
			ELSEIF (PUORDER.EQ.3) THEN
				PU1D=-60*x**2*(-1.0D0 + X) - 60*x*(-1.0D0 + X)**2
			ELSEIF (PUORDER.EQ.4) THEN
				PU1D=420*x**3*(-1.0D0 + X)**2 + 420*x**2*(-1.0D0 + X)**3
			ELSEIF (PUORDER.EQ.5) THEN
				PU1D=-2520*x**4*(-1.0D0 + X)**3 - 2520*x**3*(-1.0D0 + X)**4
			ELSEIF (PUORDER.EQ.6) THEN
				PU1D=13860*x**5*(-1.0D0 + X)**4 + 13860*x**4*(-1.0D0 + X)**5
			ELSEIF (PUORDER.EQ.7) THEN
				PU1D=-72072*x**6*(-1.0D0 + X)**5 - 72072*x**5*(-1.0D0 + X)**6
			ENDIF
        ELSE
            PU1D=0.0D0
		ENDIF
		IF (DABS(X).LE.EPS) THEN
            PU1D=0.0D0
        ENDIF
	ENDIF
END FUNCTION PU1D

END MODULE PU_1D