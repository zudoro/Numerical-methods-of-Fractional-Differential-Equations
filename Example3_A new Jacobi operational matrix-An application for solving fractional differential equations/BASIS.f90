MODULE BASIS
	
	USE NURBS
  USE GSQUAD
	USE PATCH_MAPPING

  IMPLICIT NONE

CONTAINS

!! Compute Jacobi polynomials on the physical domain
TYPE(FUNCTION_1D) FUNCTION GET_PHY_JACOBI_POLY(PHYPT,INDX,PATCH)

	REAL*8, INTENT(IN) :: PHYPT
	INTEGER, INTENT(IN) :: INDX, PATCH
	
	TYPE(FUNCTION_1D) :: F_INV, P, BS
	
	! Check if the given physical point is in the support of the local basis function
	IF (NUMPATCH.NE.1) THEN 
		IF (PATCH==1) THEN
			IF (PHYPT<DOMAIN(1) .OR. PHYPT>(PATCHBDPT(1,2) + DELTA)) THEN 
				GOTO 14
			ENDIF
		ELSEIF (PATCH==NUMPATCH) THEN 
			IF (PHYPT<(PATCHBDPT(NUMPATCH,1) - DELTA) .OR. PHYPT>DOMAIN(2)) THEN 
				GOTO 14
			ENDIF
		ELSE 
			IF (PHYPT<(PATCHBDPT(PATCH,1) - DELTA) .OR. PHYPT>(PATCHBDPT(PATCH,2) + DELTA)) THEN 
				GOTO 14
			ENDIF
		ENDIF
	ENDIF
	
	F_INV = PATCH_TO_UNITLINE(PHYPT, PATCH)
	P = JACOBI_POLY(F_INV%VAL(0), INDX)
	
	!! Applied shifted Jacobi polynomials GLOBALLY on the physical domain
	!--------------------------------------------------------------------------------------------------!
	GET_PHY_JACOBI_POLY%VAL(0) = P%VAL(0)
	GET_PHY_JACOBI_POLY%VAL(1) = P%VAL(1)*F_INV%VAL(1)
	GET_PHY_JACOBI_POLY%VAL(2) = P%VAL(2)*(F_INV%VAL(1))**2 + P%VAL(1)*F_INV%VAL(2)
	!--------------------------------------------------------------------------------------------------!
	
	!! Applied shifted Jacobi polynomials & Bernstain polynomials LOCALLY on the physical domain
	!--------------------------------------------------------------------------------------------------!
	
! 	BS = GET_DIFF_BSPLINE(F_INV%VAL(0), BASIS_KVEC, INDX, 2)
! 	
! 	IF (PATCH == 1 .OR. PATCH == NUMPATCH) THEN 
! 		GET_PHY_JACOBI_POLY%VAL(0) = BS%VAL(0)
! 		GET_PHY_JACOBI_POLY%VAL(1) = BS%VAL(1)*F_INV%VAL(1)
! 		GET_PHY_JACOBI_POLY%VAL(2) = BS%VAL(2)*(F_INV%VAL(1))**2 + BS%VAL(1)*F_INV%VAL(2)
! 	ELSE
! 		GET_PHY_JACOBI_POLY%VAL(0) = P%VAL(0)
! 		GET_PHY_JACOBI_POLY%VAL(1) = P%VAL(1)*F_INV%VAL(1)
! 		GET_PHY_JACOBI_POLY%VAL(2) = P%VAL(2)*(F_INV%VAL(1))**2 + P%VAL(1)*F_INV%VAL(2)
! 	ENDIF
	!--------------------------------------------------------------------------------------------------!
	
	GOTO 15
	
	14 CONTINUE
	GET_PHY_JACOBI_POLY%VAL(0) = 0.0D0
	GET_PHY_JACOBI_POLY%VAL(1) = 0.0D0
	GET_PHY_JACOBI_POLY%VAL(2) = 0.0D0
	
	15 CONTINUE
	
END FUNCTION GET_PHY_JACOBI_POLY

!! Jacobi polynomial defined on [0, L]
TYPE(FUNCTION_1D) FUNCTION JACOBI_POLY(X,INDX,FD_SWITCH)

	!! global variable used
	! ALPHA, BETA, JORDER
	
	REAL*8, INTENT(IN) :: X
	INTEGER, INTENT(IN) :: INDX
	CHARACTER(LEN=1), OPTIONAL, INTENT(IN) :: FD_SWITCH
	
	TYPE(FUNCTION_1D) :: P
	REAL*8 :: L, NUM, DEN, POWER_TERM, NUM_DEN
	INTEGER :: I, J, K
	
	!! Define the shifed Jacobi polynomials on [0, h]
	!------------------------------------!
	L = DELTAH
	!------------------------------------!
	
	IF (PRESENT(FD_SWITCH) .AND. FD_SWITCH=='Y') THEN 
	ELSE 
		IF (INDX>JORDER) THEN 
			PRINT*, 'The index of Jacobi polynomial is exceed the order of basis function'
			STOP 
		ENDIF
	ENDIF
	
	I = INDX
	
	!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------!
	P%VAL(:) = 0.0D0
	
	DO K = 0, I
! 		NUM = (-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0))
! 		DEN = DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*DEXP(GAMMLN(K*1.0D0 + 1.0D0))*L**K
		
		IF (DABS(ALPHA + 0.50D0)<=EPS .AND. DABS(BETA + 0.50D0)<=EPS .AND. I==0) THEN 
			NUM_DEN = (-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))/(DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*DEXP(GAMMLN(K*1.0D0 + 1.0D0))*L**K)
		ELSE
			NUM_DEN = ((-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0)))/(DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*DEXP(GAMMLN(K*1.0D0 + 1.0D0))*L**K)
		ENDIF
		
		IF (DABS(X)<=EPS) THEN 
			IF (K==0) THEN 
				POWER_TERM = 1.0D0 
			ELSE 
				POWER_TERM = 0.0D0 
			ENDIF 
		ELSE 
			IF (K==0) THEN 
				POWER_TERM = 1.0D0 
			ELSE 
				POWER_TERM = X**K 
			ENDIF
		ENDIF
		
		P%VAL(0) = P%VAL(0) + NUM_DEN*X**K
		
		DO J = 0, MAX_DIFF_ORDER - 1
			IF (K>=(J+1)) THEN 
				P%VAL(J+1) = P%VAL(J+1) + NUM_DEN*(DEXP(GAMMLN(K*1.0D0 + 1.0D0))/DEXP(GAMMLN(K*1.0D0 - J*1.0D0)))*X**(K-(J+1))
			ENDIF
		ENDDO
	ENDDO
	
	JACOBI_POLY%VAL(:) = P%VAL(:)
	GOTO 114
	!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------!
	
	
	!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------!
	IF (INDX==0) THEN 
	
		JACOBI_POLY%VAL(0) = 1.0D0
		
		JACOBI_POLY%VAL(1) = 0.0D0
		
		JACOBI_POLY%VAL(2) = 0.0D0
	
	ELSEIF (INDX==1) THEN 

		JACOBI_POLY%VAL(0) = -(DEXP(GAMMLN(2.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA))) + (X*DEXP(GAMMLN(3.0D0 + ALPHA + BETA)))/(L*DEXP(GAMMLN(2.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(1) = DEXP(GAMMLN(3.0D0 + ALPHA + BETA))/(L*DEXP(GAMMLN(2.0D0 +  ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = 0.0D0

	ELSEIF (INDX==2) THEN 

		JACOBI_POLY%VAL(0) = (DEXP(GAMMLN(3.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA)) + (X*(-2.0D0*L*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + ALPHA + BETA)) + X*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA))))/(L**2*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(3.0D0 + ALPHA + BETA))))/2.0D0
		
		JACOBI_POLY%VAL(1) = (-(L*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + ALPHA + BETA))) + X*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA)))/(L**2*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(3.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = DEXP(GAMMLN(5.0D0 + ALPHA + BETA))/(L**2*DEXP(GAMMLN(3.0D0 + ALPHA + BETA)))

	ELSEIF (INDX==3) THEN 

		JACOBI_POLY%VAL(0) = (-(DEXP(GAMMLN(4.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA))) + (X*(-3.0D0*L*X*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(3.0D0 + BETA))*(3*L**2*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA)) + X**2*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)))))/(L**3*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + ALPHA + BETA))))/6.0D0
		
		JACOBI_POLY%VAL(1) = (-2*L*X*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(3.0D0 + BETA))*(L**2*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA)) + X**2*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA))))/(2.*L**3*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = (-(L*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA))) + X*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)))/(L**3*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + ALPHA + BETA)))

	ELSEIF (INDX==4) THEN 

		JACOBI_POLY%VAL(0) = (DEXP(GAMMLN(5.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA)) + (X*(6*L**2*X*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(3.0D0 + BETA))*(-4*L*X**2*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(4.0D0 + BETA))*(-4*L**3*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA)) + X**3*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA))))))/(L**4*DEXP(GAMMLN(2.0D0 + BETA))*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA))))/24.0D0
		
		JACOBI_POLY%VAL(1) = (3*L**2*X*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(3.0D0 + BETA))*(-3*L*X**2*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(4.0D0 + BETA))*(-(L**3*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA))) + X**3*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))))/(6.*L**4*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = (-2*L*X*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(4.0D0 + BETA))*(L**2*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)) + X**2*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA))))/(2.*L**4*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + ALPHA + BETA)))

	ELSEIF (INDX==5) THEN 

		JACOBI_POLY%VAL(0) = (-(DEXP(GAMMLN(6.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA))) + (X*((5*L**4*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 + BETA)) + X*((-10*L**3*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) + (10*L**2*X*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) - (5*L*X**2*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) + X**3*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))))/(L**5*DEXP(GAMMLN(6.0D0 + ALPHA + BETA))))/120.0D0
		
		JACOBI_POLY%VAL(1) = (-4*L**3*X*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(3.0D0 + BETA))*(6*L**2*X**2*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(4.0D0 + BETA))*(-4*L*X**3*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(5.0D0 + BETA))*(L**4*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)) + X**4*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA))))))/(24.*L**5*DEXP(GAMMLN(2.0D0 +  BETA))*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = (3*L**2*X*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(4.0D0 + BETA))*(-3*L*X**2*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(5.0D0 + BETA))*(-(L**3*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA))) + X**3*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))))/(6.*L**5*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + ALPHA + BETA)))

	ELSEIF (INDX==6) THEN 

		JACOBI_POLY%VAL(0) = (DEXP(GAMMLN(7.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA)) + (X*((-6*L**5*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 + BETA)) + X*((15*L**4*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) - (20*L**3*X*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) + (15*L**2*X**2*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) - (6*L*X**3*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(12.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) + X**4*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))))/(L**6*DEXP(GAMMLN(7.0D0 + ALPHA + BETA))))/720.0D0
		
		JACOBI_POLY%VAL(1) = (-((L**5*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 +  BETA))) + X*((5*L**4*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) + X*((-10*L**3*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) + (10*L**2*X*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) - (5*L*X**2*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(12.0D0 +  ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) + X**3*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))))/(120.*L**6*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = (-4*L**3*X*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(4.0D0 + BETA))*(6*L**2*X**2*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)) + DEXP(GAMMLN(5.0D0 + BETA))*(-4*L*X**3*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(12.0D0 +  ALPHA + BETA)) + DEXP(GAMMLN(6.0D0 + BETA))*(L**4*DEXP(GAMMLN(7.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)) + X**4*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA))))))/(24.*L**6*DEXP(GAMMLN(3.0D0 + BETA))*DEXP(GAMMLN(4.0D0 + BETA))*DEXP(GAMMLN(5.0D0 + BETA))*DEXP(GAMMLN(6.0D0 + BETA))*DEXP(GAMMLN(7.0D0 + ALPHA + BETA)))

	ELSEIF (INDX==7) THEN 

		JACOBI_POLY%VAL(0) = (-(DEXP(GAMMLN(8.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA))) + (X*((7*L**6*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 + BETA)) + X*((-21*L**5*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) + (35*L**4*X*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) - (35*L**3*X**2*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(12.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) + (21*L**2*X**3*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) - (7*L*X**4*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(14.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(7.0D0 + BETA)) + X**5*DEXP(GAMMLN(15.0D0 + ALPHA + BETA)))))/(L**7*DEXP(GAMMLN(8.0D0 + ALPHA + BETA))))/5040.0D0
		
		JACOBI_POLY%VAL(1) = ((L**6*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 +  BETA)) + X*((-6*L**5*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) + X*((15*L**4*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) - (20*L**3*X*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(12.0D0 +  ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) + (15*L**2*X**2*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) - (6*L*X**3*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(14.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(7.0D0 + BETA)) + X**4*DEXP(GAMMLN(15.0D0 + ALPHA + BETA)))))/(720.*L**7*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = (-((L**5*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA))) + X*((5*L**4*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) + X*((-10*L**3*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(12.0D0 +  ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) + (10*L**2*X*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) - (5*L*X**2*DEXP(GAMMLN(8.0D0 + BETA))*DEXP(GAMMLN(14.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(7.0D0 + BETA)) + X**3*DEXP(GAMMLN(15.0D0 + ALPHA + BETA)))))/(120.*L**7*DEXP(GAMMLN(8.0D0 + ALPHA + BETA)))

	ELSEIF (INDX==8) THEN 

		JACOBI_POLY%VAL(0) = (DEXP(GAMMLN(9.0D0 + BETA))/DEXP(GAMMLN(1.0D0 + BETA)) + (X*((-8*L**7*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 + BETA)) + X*((28*L**6*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) - (56*L**5*X*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(12.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) + (70*L**4*X**2*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) - (56*L**3*X**3*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(14.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) + (28*L**2*X**4*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(15.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(7.0D0 + BETA)) - (8*L*X**5*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(16.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(8.0D0 + BETA)) + X**6*DEXP(GAMMLN(17.0D0 + ALPHA + BETA)))))/(L**8*DEXP(GAMMLN(9.0D0 + ALPHA + BETA))))/40320.0D0
		
		JACOBI_POLY%VAL(1) = (-((L**7*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(10.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(2.0D0 +  BETA))) + X*((7*L**6*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) + X*((-21*L**5*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(12.0D0 +  ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) + (35*L**4*X*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) - (35*L**3*X**2*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(14.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) + (21*L**2*X**3*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(15.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(7.0D0 + BETA)) - (7*L*X**4*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(16.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(8.0D0 + BETA)) + X**5*DEXP(GAMMLN(17.0D0 + ALPHA + BETA)))))/(5040.*L**8*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))
		
		JACOBI_POLY%VAL(2) = ((L**6*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(11.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(3.0D0 + BETA)) + X*((-6*L**5*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(12.0D0 +  ALPHA + BETA)))/DEXP(GAMMLN(4.0D0 + BETA)) + X*((15*L**4*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(13.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(5.0D0 + BETA)) - (20*L**3*X*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(14.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(6.0D0 + BETA)) + (15*L**2*X**2*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(15.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(7.0D0 + BETA)) - (6*L*X**3*DEXP(GAMMLN(9.0D0 + BETA))*DEXP(GAMMLN(16.0D0 + ALPHA + BETA)))/DEXP(GAMMLN(8.0D0 + BETA)) + X**4*DEXP(GAMMLN(17.0D0 + ALPHA + BETA)))))/(720.0D0*L**8*DEXP(GAMMLN(9.0D0 + ALPHA + BETA)))
		
	ENDIF
	!---------------------------------------------------------------------------------------------------------------------------------------------------------------------------!
	114 CONTINUE
END FUNCTION JACOBI_POLY


!! Approximation of Fractional Derivative of order v of the shifted Jacobi polyomials of degree i on [0, L]
REAL*8 FUNCTION GET_FD_JACOBI_POLY(REFPT, INDX)
	
	REAL*8, INTENT(IN) :: REFPT
	INTEGER, INTENT(IN) :: INDX
	
	TYPE(FUNCTION_1D) :: P
	REAL*8 :: X
	
	INTEGER :: I, J, K, II, JJ, KK, MAX_JORDER
	REAL*8 :: S_NU, S0, S1, S2, NUM, DEN, L, HJ, RAT
	
	!! Define the shifed Jacobi polynomials on [0, h]
	!------------------------------------!
	L = DELTAH
	!------------------------------------!
	
	!! truncation of the order of Jacobi polynomial
	!------------------------------------!
	MAX_JORDER = JORDER
	!------------------------------------!
	
	I = INDX
	
	IF (I < M) THEN 
		GOTO 625
	ENDIF
	
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	GET_FD_JACOBI_POLY = 0.0D0
	DO K = INT_M, I
		IF (DABS(ALPHA + 0.50D0)<=EPS .AND. DABS(BETA + 0.50D0)<=EPS .AND. I==0) THEN 
			NUM = (-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))
			DEN = DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 - NU + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*L**K
		ELSE
			NUM = (-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0))
			DEN = DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 - NU + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*L**K
		ENDIF
		
		GET_FD_JACOBI_POLY = GET_FD_JACOBI_POLY + (NUM/DEN)*(REFPT**(K*1.0D0-NU))

! 		RAT = (-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0))/(DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 - NU + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*L**K)
! 		GET_FD_JACOBI_POLY = GET_FD_JACOBI_POLY + RAT*(REFPT**(K*1.0D0-NU))
	ENDDO
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	
	
	!! Summarized form of the eqn (3.2)
	!-------------------------------------------------------------------------------------------------------------------------------------------!
! 	S0 = 0.0D0
! 	DO J = 0, MAX_JORDER
! 		S1 = 0.0D0
! 		DO K = INT_M, I
! 			S2 = 0.0D0
! 			DO KK = 0, J
! 				NUM = (-1.0D0)**(J-KK)*DEXP(GAMMLN(1.0D0*J + 1.0D0*KK + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(1.0D0*KK + 1.0D0*K + BETA - NU + 1.0D0))
! 				DEN = DEXP(GAMMLN(1.0D0*KK + BETA + 1.0D0))*DEXP(GAMMLN(1.0D0*KK + 1.0D0*K + ALPHA + BETA - NU + 2.0D0))*DEXP(GAMMLN(J*1.0D0 - KK*1.0D0 + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + 1.0D0))
! 				S2 = S2 + NUM/DEN
! 			ENDDO
! 			
! 			NUM = (-1.0D0)**(I-K)*DEXP(GAMMLN(1.0D0*I + 1.0D0*K + ALPHA + BETA + 1.0D0))
! 			DEN = DEXP(GAMMLN(1.0D0*K + BETA + 1.0D0))*DEXP(GAMMLN(1.0D0*K - NU + 1.0D0))*DEXP(GAMMLN(1.0D0*(I-K)+1.0D0))
! 			
! 			S1 = S1 + (NUM/DEN)*S2
! 		ENDDO
! 		
! 		P = JACOBI_POLY(REFPT, J, 'Y')
! 		
! 		S0 = S0 + ((2.0D0*J + ALPHA + BETA + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + 1.0D0))/DEXP(GAMMLN(1.0D0*J + ALPHA + 1.0D0)))*S1*P%VAL(0)
! 		
! 	ENDDO
! 	
! 	S_NU = (DEXP(GAMMLN(1.0D0*I + BETA + 1.0D0))/(L**NU*DEXP(GAMMLN(1.0D0*I + ALPHA + BETA + 1.0D0))))*S0
! 	
! 	GET_FD_JACOBI_POLY = S_NU
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	
	!! As in the paper "On Shifted Jacobi spectral approximation for solving FDE"
	!-------------------------------------------------------------------------------------------------------------------------------------------!
! 	S0 = 0.0D0
! 	DO J = 0, MAX_JORDER
! 		NUM = L**(ALPHA + BETA + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + ALPHA + 1.0D0))*DEXP(GAMMLN(J*1.0D0 + BETA + 1.0D0))
! 		DEN = (2.0D0*J + ALPHA + BETA + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + 1.0D0))*DEXP(GAMMLN(J*1.0D0 + ALPHA + BETA + 1.0D0))
! 		HJ = NUM/DEN
! 		S1 = 0.0D0
! 		DO K = INT_M, I
! 			S2 = 0.0D0
! 			DO KK = 0, J
! 				NUM = (-1.0D0)**(J - KK)*DEXP(GAMMLN(J*1.0D0 + KK*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(ALPHA + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + K*1.0D0 + BETA - NU + 1.0D0))
! 				DEN = DEXP(GAMMLN(KK*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + K*1.0D0 + ALPHA + BETA - NU + 2.0D0))*DEXP(GAMMLN(J*1.0D0 - KK*1.0D0 + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + 1.0D0))
! 				S2 = S2 + NUM/DEN
! 			ENDDO
! 			NUM = (-1.0D0)**(I - K)*L**(ALPHA + BETA - NU + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0))
! 			DEN = HJ*DEXP(GAMMLN(J*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 - NU + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))
! 			S1 = S1 + (NUM/DEN)*S2
! 		ENDDO
! 		P = JACOBI_POLY(REFPT, J, 'Y')
! 		S0 = S0 + S1*P%VAL(0)
! 	ENDDO
! ! 	STOP
! 	GET_FD_JACOBI_POLY = S0
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	
	GOTO 72
	
	625 CONTINUE
	GET_FD_JACOBI_POLY = 0.0D0
	
	72 CONTINUE
END FUNCTION GET_FD_JACOBI_POLY



!! Approximation of Fractional Derivative of order v of the shifted Jacobi polyomials of degree i on [0, L]
REAL*8 FUNCTION GET_PHY_FD_JACOBI_POLY(PHYPT, INDX, PATCH)
	
	REAL*8, INTENT(IN) :: PHYPT
	INTEGER, INTENT(IN) :: INDX, PATCH
	
	TYPE(FUNCTION_1D) :: F_INV, P
	REAL*8 :: X
	
	INTEGER :: I, J, K, II, JJ, KK, MAX_JORDER
	REAL*8 :: S_NU, S0, S1, S2, NUM, DEN, L, HJ
	
	!! Define the shifed Jacobi polynomials on [0, h]
	!------------------------------------!
	L = DELTAH
	!------------------------------------!
	
	!! truncation of the order of Jacobi polynomial
	!------------------------------------!
	MAX_JORDER = JORDER
	!------------------------------------!
	
	F_INV = PATCH_TO_UNITLINE(PHYPT, PATCH)
	
	I = INDX
	
	
	IF (I < M) THEN 
		GOTO 625
	ENDIF
	
	
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	GET_PHY_FD_JACOBI_POLY = 0.0D0
	DO K = INT_M, I
		NUM = (-1.0D0)**(I-K)*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0))
		DEN = DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 - NU + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))*L**K
		GET_PHY_FD_JACOBI_POLY = GET_PHY_FD_JACOBI_POLY + (NUM/DEN)*(F_INV%VAL(0)**(K*1.0D0 - NU))
	ENDDO
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	
	
	!! Summarized form of the eqn (3.2)
	!-------------------------------------------------------------------------------------------------------------------------------------------!
! 	S0 = 0.0D0
! 	DO J = 0, MAX_JORDER
! 		S1 = 0.0D0
! 		DO K = INT_M, I
! 			S2 = 0.0D0
! 			DO KK = 0, J
! 				NUM = (-1.0D0)**(J-KK)*DEXP(GAMMLN(1.0D0*J + 1.0D0*KK + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(1.0D0*KK + 1.0D0*K + BETA - NU + 1.0D0))
! 				DEN = DEXP(GAMMLN(1.0D0*KK + BETA + 1.0D0))*DEXP(GAMMLN(1.0D0*KK + 1.0D0*K + ALPHA + BETA - NU + 2.0D0))*DEXP(GAMMLN(J*1.0D0 - KK*1.0D0 + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + 1.0D0))
! 				S2 = S2 + NUM/DEN
! ! 				PRINT*, FACTORIAL(J-KK), FACTORIAL(KK)
! 			ENDDO
! 			
! 			NUM = (-1.0D0)**(I-K)*DEXP(GAMMLN(1.0D0*I + 1.0D0*K + ALPHA + BETA + 1.0D0))
! 			DEN = DEXP(GAMMLN(1.0D0*K + BETA + 1.0D0))*DEXP(GAMMLN(1.0D0*K - NU + 1.0D0))*DEXP(GAMMLN(I-K+1.0D0))
! 			
! 			S1 = S1 + (NUM/DEN)*S2
! 		ENDDO
! 		
! 		P = JACOBI_POLY(F_INV%VAL(0), J, 'Y')
! 		
! 		S0 = S0 + ((2.0D0*J + ALPHA + BETA + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + 1.0D0))/DEXP(GAMMLN(1.0D0*J + ALPHA + 1.0D0)))*S1*P%VAL(0)
! ! 		PRINT*, J, FACTORIAL(J)
! 		
! 	ENDDO
! 	
! 	S_NU = (DEXP(GAMMLN(1.0D0*I + BETA + 1.0D0))/(L**NU*DEXP(GAMMLN(1.0D0*I + ALPHA + BETA + 1.0D0))))*S0
! 	
! 	GET_PHY_FD_JACOBI_POLY = S_NU
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	
	!! As in the paper "On Shifted Jacobi spectral approximation for solving FDE"
	!-------------------------------------------------------------------------------------------------------------------------------------------!
! 	S0 = 0.0D0
! 	DO J = 0, MAX_JORDER
! 		NUM = L**(ALPHA + BETA + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + ALPHA + 1.0D0))*DEXP(GAMMLN(J*1.0D0 + BETA + 1.0D0))
! 		DEN = (2.0D0*J + ALPHA + BETA + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + 1.0D0))*DEXP(GAMMLN(J*1.0D0 + ALPHA + BETA + 1.0D0))
! 		HJ = NUM/DEN
! ! 		PRINT*, 'HJ', NUM, DEN, HJ
! 		S1 = 0.0D0
! 		DO K = INT_M, I
! 			S2 = 0.0D0
! 			DO KK = 0, J
! 				NUM = (-1.0D0)**(J - KK)*DEXP(GAMMLN(J*1.0D0 + KK*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(ALPHA + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + K*1.0D0 + BETA - NU + 1.0D0))
! 				DEN = DEXP(GAMMLN(KK*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + K*1.0D0 + ALPHA + BETA - NU + 2.0D0))*DEXP(GAMMLN(J*1.0D0 - KK*1.0D0 + 1.0D0))*DEXP(GAMMLN(KK*1.0D0 + 1.0D0))
! 				S2 = S2 + NUM/DEN
! ! 				PRINT*, 'S2', S2
! 			ENDDO
! 			NUM = (-1.0D0)**(I - K)*L**(ALPHA + BETA - NU + 1.0D0)*DEXP(GAMMLN(J*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + K*1.0D0 + ALPHA + BETA + 1.0D0))
! 			DEN = HJ*DEXP(GAMMLN(J*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 + BETA + 1.0D0))*DEXP(GAMMLN(I*1.0D0 + ALPHA + BETA + 1.0D0))*DEXP(GAMMLN(K*1.0D0 - NU + 1.0D0))*DEXP(GAMMLN(I*1.0D0 - K*1.0D0 + 1.0D0))
! 			S1 = S1 + (NUM/DEN)*S2
! ! 			PRINT*, 'S1', S1
! 		ENDDO
! 		P = JACOBI_POLY(F_INV%VAL(0), J, 'Y')
! ! 		PRINT*, 'P', P%VAL(0)
! 		S0 = S0 + S1*P%VAL(0)
! 	ENDDO
! ! 	STOP
! 	GET_PHY_FD_JACOBI_POLY = S0
	!-------------------------------------------------------------------------------------------------------------------------------------------!
	
	GOTO 72
	
	625 CONTINUE
	GET_PHY_FD_JACOBI_POLY = 0.0D0
	
	72 CONTINUE
END FUNCTION GET_PHY_FD_JACOBI_POLY



! Lagrange Interpolating functions on [-1, 1]
!-------------------------------------------------------------------------------------------------------------------------------------------!
REAL*8 FUNCTION REF1D(X,INDX,DIFF)

	REAL*8, INTENT(IN)::X
	INTEGER, INTENT(IN)::INDX,DIFF
	
	IF (X<-1.0D0 .OR. X>1.0D0) THEN
		IF (DIFF==0) THEN
			REF1D = 0.0D0
		ELSEIF (DIFF==1) THEN
			REF1D = 0.0D0
		ELSEIF (DIFF==2) THEN
			REF1D = 0.0D0
		ENDIF
		GOTO 111
	ENDIF
	
	IF(IORDER.EQ.2)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=((-1.0D0+X)*X)/2.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=1.0D0-X**2
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(X*(1.0D0+X))/2.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=-0.50D0+X
			ELSEIF(INDX.EQ.1)THEN
				REF1D=-2.0D0*X
			ELSEIF(INDX.EQ.2)THEN
				REF1D=0.50D0+X
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.3)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=-((-1+X)*(-1+3*X)*(1+3*X))/16.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(9*(-1+X)*(1+X)*(-1+3*X))/16.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-9*(-1+X)*(1+X)*(1+3*X))/16.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=((1+X)*(-1+3*X)*(1+3*X))/16.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(1.0D0+18*X-27*X**2)/16.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(9*(-3.0D0-2*X+9*X**2))/16.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-9*(-3.0D0+2*X+9*X**2))/16.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-1.0D0+18*X+27*X**2)/16.0D0
			ENDIF
		ELSEIF(DIFF.EQ.2)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(-9.0D0*(-1.0D0 + 3*X))/8.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(9.0D0*(-1.0D0 + 9*X))/8.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-9.0D0*(1.0D0 + 9*X))/8.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(9.0D0*(1.0D0 + 3*X))/8.0D0
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.4)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(2.0D0*(-1.0D0+X)*(-0.50D0+X)*X*(0.50D0+X))/3.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-8.0D0*(-1.0D0+X)*(-0.50D0+X)*X*(1.0D0+X))/3.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=4*(-1.0D0+X)*(-0.50D0+X)*(0.50D0+X)*(1.0D0+X)
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-8.0D0*(-1.0D0+X)*X*(0.50D0+X)*(1.0D0+X))/3.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(2.0D0*(-0.50D0+X)*X*(0.50D0+X)*(1.0D0+X))/3.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(1/6.0D0)-(X/3)-(2*X**2)+(8*X**3/3)
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-4*(1-4*X-3*X**2+8*X**3))/3.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=2*X*(-5+8*X**2)
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-4*(-1-4*X+3*X**2+8*X**3))/3.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=-(1/6.0D0)-(X/3)+(2*X**2)+(8*X**3/3)
			ENDIF
		ELSEIF (DIFF.EQ.2) THEN
			IF(INDX.EQ.0)THEN
				REF1D = -1.D0/3.D0 - 4.D0*X + 8.D0*X**2
			ELSEIF(INDX.EQ.1)THEN
				REF1D = -(4.D0/3.D0)*(-4.D0 - 6.D0*X + 24.D0*X**2)
			ELSEIF(INDX.EQ.2)THEN
				REF1D = 32.D0*X**2 + 2.D0*(-5.D0 + 8.D0*X**2)
			ELSEIF(INDX.EQ.3)THEN
				REF1D = -(4.D0/3.D0)*(-4.D0 + 6.D0*X + 24.D0*X**2)
			ELSEIF(INDX.EQ.4)THEN
				REF1D = -1.D0/3.D0 + 4.D0*X + 8.D0*X**2
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.5)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=-((-1+X)*(-3+5*X)*(-1+5*X)*(1+5*X)*(3+5*X))/768.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(25*(-1+X)*(1+X)*(-3+5*X)*(-1+5*X)*(1+5*X))/768.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-25*(-1+X)*(1+X)*(-3+5*X)*(-1+5*X)*(3+5*X))/384.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(25*(-1+X)*(1+X)*(-3+5*X)*(1+5*X)*(3+5*X))/384.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(-25*(-1+X)*(1+X)*(-1+5*X)*(1+5*X)*(3+5*X))/768.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=((1+X)*(-3+5*X)*(-1+5*X)*(1+5*X)*(3+5*X))/768.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(-9-500*X+750*X**2+2500*X**3-3125*X**4)/768.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(25*(5+156*X-390*X**2-300*X**3+625*X**4))/768.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-25*(45+68*X-510*X**2-100*X**3+625*X**4))/384.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(25*(45-68*X-510*X**2+100*X**3+625*X**4))/384.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(-25*(5-156*X-390*X**2+300*X**3+625*X**4))/768.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(9-500*X-750*X**2+2500*X**3+3125*X**4)/768.0D0
			ENDIF
		ELSEIF(DIFF.EQ.2)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(-125.0D0*(1 - 3*X - 15*X**2 + 25*X**3))/192.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(25.0D0*(39 - 195*X - 225*X**2 + 625*X**3))/192.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-25.0D0*(17 - 255*X - 75*X**2 + 625*X**3))/96.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(25.0D0*(-17 - 255*X + 75*X**2 + 625*X**3))/96.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(-25.0D0*(-39 - 195*X + 225*X**2 + 625*X**3))/192.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(125.0D0*(-1 - 3*X + 15*X**2 + 25*X**3))/192.0D0
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.6)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=((-1+X)*X*(-2+3*X)*(-1+3*X)*(1+3*X)*(2+3*X))/80.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-9*(-1+X)*X*(1+X)*(-2+3*X)*(-1+3*X)*(1+3*X))/40.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(9*(-1+X)*X*(1+X)*(-2+3*X)*(-1+3*X)*(2+3*X))/16.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(4-49*X**2+126*X**4-81*X**6)/4.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(9*(-1+X)*X*(1+X)*(-2+3*X)*(1+3*X)*(2+3*X))/16.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(-9*(-1+X)*X*(1+X)*(-1+3*X)*(1+3*X)*(2+3*X))/40.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(X*(1+X)*(-2+3*X)*(-1+3*X)*(1+3*X)*(2+3*X))/80.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(-4+8*X+135*X**2-180*X**3-405*X**4+486*X**5)/80.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-9*(-1+3*X+30*X**2-60*X**3-45*X**4+81*X**5))/20.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(9*(-4+24*X+39*X**2-156*X**3-45*X**4+162*X**5))/16.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-49*X+252*X**3-243*X**5)/2.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(9*(4+24*X-39*X**2-156*X**3+45*X**4+162*X**5))/16.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(-9*(1+3*X-30*X**2-60*X**3+45*X**4+81*X**5))/20.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(4+8*X-135*X**2-180*X**3+405*X**4+486*X**5)/80.0D0
			ENDIF
		ELSEIF(DIFF.EQ.2)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(8 + 270*X - 540*X**2 - 1620*X**3 + 2430*X**4)/80.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-9*(3 + 60*X - 180*X**2 - 180*X**3 + 405*X**4))/20.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(9*(24 + 78*X - 468*X**2 - 180*X**3 + 810*X**4))/16.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-49 + 756*X**2 - 1215*X**4)/2.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(9*(24 - 78*X - 468*X**2 + 180*X**3 + 810*X**4))/16.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(-9*(3 - 60*X - 180*X**2 + 180*X**3 + 405*X**4))/20.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(8 - 270*X - 540*X**2 + 1620*X**3 + 2430*X**4)/80.0D0
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.7)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=-((-1+X)*(-5+7*X)*(-3+7*X)*(-1+7*X)*(1+7*X)*(3+7*X)*(5+7*X))/92160.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(49*(-1+X)*(1+X)*(-5+7*X)*(-3+7*X)*(-1+7*X)*(1+7*X)*(3+7*X))/92160.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-49*(-1+X)*(1+X)*(-5+7*X)*(-3+7*X)*(-1+7*X)*(1+7*X)*(5+7*X))/30720.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(49*(-1+X)*(1+X)*(-5+7*X)*(-3+7*X)*(-1+7*X)*(3+7*X)*(5+7*X))/18432.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(-49*(-1+X)*(1+X)*(-5+7*X)*(-3+7*X)*(1+7*X)*(3+7*X)*(5+7*X))/18432.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(49*(-1+X)*(1+X)*(-5+7*X)*(-1+7*X)*(1+7*X)*(3+7*X)*(5+7*X))/30720.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(-49*(-1+X)*(1+X)*(-3+7*X)*(-1+7*X)*(1+7*X)*(3+7*X)*(5+7*X))/92160.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=((1+X)*(-5+7*X)*(-3+7*X)*(-1+7*X)*(1+7*X)*(3+7*X)*(5+7*X))/92160.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(225+25382*X-38073*X**2-336140*X**3+420175*X**4+705894*X**5-823543*X**6)/92160.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(49*(-63-4990*X+10479*X**2+57820*X**3-101185*X**4-72030*X**5+117649*X**6))/92160.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-49*(-175-7794*X+27279*X**2+44100*X**3-128625*X**4-43218*X**5+117649*X**6))/30720.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(49*(-1575-3782*X+39711*X**2+16268*X**3-142345*X**4-14406*X**5+117649*X**6))/18432.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(-49*(-1575+3782*X+39711*X**2-16268*X**3-142345*X**4+14406*X**5+117649*X**6))/18432.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(49*(-175+7794*X+27279*X**2-44100*X**3-128625*X**4+43218*X**5+117649*X**6))/30720.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(-49*(-63+4990*X+10479*X**2-57820*X**3-101185*X**4+72030*X**5+117649*X**6))/92160.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=(-225+25382*X+38073*X**2-336140*X**3-420175*X**4+705894*X**5+823543*X**6)/92160.0D0
			ENDIF
		ELSEIF(DIFF.EQ.2)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(-343.0D0*(-37.0D0 + 111*X + 1470*X**2 - 2450*X**3 - 5145*X**4 + 7203*X**5))/46080.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(49.0D0*(-2495.0D0 + 10479*X + 86730*X**2 - 202370*X**3 - 180075*X**4 + 352947*X**5))/46080.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(-49.0D0*(-1299.0D0 + 9093*X + 22050*X**2 - 85750*X**3 - 36015*X**4 + 117649*X**5))/5120.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(49.0D0*(-1891.0D0 + 39711*X + 24402*X**2 - 284690*X**3 - 36015*X**4 + 352947*X**5))/9216.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(-49.0D0*(1891.0D0 + 39711*X - 24402*X**2 - 284690*X**3 + 36015*X**4 + 352947*X**5))/9216.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(49.0D0*(1299.0D0 + 9093*X - 22050*X**2 - 85750*X**3 + 36015*X**4 + 117649*X**5))/5120.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(-49.0D0*(2495.0D0 + 10479*X - 86730*X**2 - 202370*X**3 + 180075*X**4 + 352947*X**5))/46080.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=(343.0D0*(37.0D0 + 111*X - 1470*X**2 - 2450*X**3 + 5145*X**4 + 7203*X**5))/46080.0D0
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.8)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D =((-1+X)*X*(-1+2*X)*(1+2*X)*(-3+4*X)*(-1+4*X)*(1+4*X)*(3+4*X))/630.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-16*(-1+X)*X*(1+X)*(-1+2*X)*(1+2*X)*(-3+4*X)*(-1+4*X)*(1+4*X))/315.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(4*(-1+X)*X*(1+X)*(-1+2*X)*(-3+4*X)*(-1+4*X)*(1+4*X)*(3+4*X))/45.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-16*(-1+X)*X*(1+X)*(-1+2*X)*(1+2*X)*(-3+4*X)*(-1+4*X)*(3+4*X))/45.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(9.0D0-205*X**2+1092*X**4-1920*X**6+1024*X**8)/9.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(-16*(-1+X)*X*(1+X)*(-1+2*X)*(1+2*X)*(-3+4*X)*(1+4*X)*(3+4*X))/45.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(4*(-1+X)*X*(1+X)*(1+2*X)*(-3+4*X)*(-1+4*X)*(1+4*X)*(3+4*X))/45.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=(-16*(-1+X)*X*(1+X)*(-1+2*X)*(1+2*X)*(-1+4*X)*(1+4*X)*(3+4*X))/315.0D0
			ELSEIF(INDX.EQ.8)THEN
				REF1D=(X*(1+X)*(-1+2*X)*(1+2*X)*(-3+4*X)*(-1+4*X)*(1+4*X)*(3+4*X))/630.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(9-18*X-588*X**2+784*X**3+4480*X**4-5376*X**5-7168*X**6+8192*X**7)/630.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-16*(3-8*X-189*X**2+336*X**3+1260*X**4-2016*X**5-1344*X**6+2048*X**7))/315.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(4*(9-36*X-507*X**2+1352*X**3+2080*X**4-4992*X**5-1792*X**6+4096*X**7))/45.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-16*(9-72*X-183*X**2+976*X**3+580*X**4-2784*X**5-448*X**6+2048*X**7))/45.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(2*X*(-205+2184*X**2-5760*X**4+4096*X**6))/9.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(-16*(-9-72*X+183*X**2+976*X**3-580*X**4-2784*X**5+448*X**6+2048*X**7))/45.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(4*(-9-36*X+507*X**2+1352*X**3-2080*X**4-4992*X**5+1792*X**6+4096*X**7))/45.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=(-16*(-3-8*X+189*X**2+336*X**3-1260*X**4-2016*X**5+1344*X**6+2048*X**7))/315.0D0
			ELSEIF(INDX.EQ.8)THEN
				REF1D=(-9-18*X+588*X**2+784*X**3-4480*X**4-5376*X**5+7168*X**6+8192*X**7)/630.0D0
			ENDIF
		ELSEIF(DIFF.EQ.2) THEN
			IF(INDX.EQ.0) THEN
				REF1D = (-9D0 - 588*X + 1176*X**2 + 8960*X**3 - 13440*X**4 - 21504*X**5 + 28672*X**6)/315.D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D = (-32*(-4D0 - 189*X + 504*X**2 + 2520*X**3 - 5040*X**4 - 4032*X**5 + 7168*X**6))/315.D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D = (8*(-18 - 507*X + 2028*X**2 + 4160*X**3 - 12480*X**4 - 5376*X**5 + 14336*X**6))/45.D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D = (-32*(-36D0 - 183*X + 1464*X**2 + 1160*X**3 - 6960*X**4 - 1344*X**5 + 7168*X**6))/45.D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D = -45.55555555555555550D0 + 1456*X**2 - 6400*X**4 + (57344*X**6)/9.D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D = (-32*(-36D0 + 183*X + 1464*X**2 - 1160*X**3 - 6960*X**4 + 1344*X**5 + 7168*X**6))/45.D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D = (8*(-18D0 + 507*X + 2028*X**2 - 4160*X**3 - 12480*X**4 + 5376*X**5 + 14336*X**6))/45.D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D = (-32*(-4D0 + 189*X + 504*X**2 - 2520*X**3 - 5040*X**4 + 4032*X**5 + 7168*X**6))/315.D0
			ELSEIF(INDX.EQ.8)THEN
				REF1D = (-9D0 + 588*X + 1176*X**2 - 8960*X**3 - 13440*X**4 + 21504*X**5 + 28672*X**6)/315.D0
			ENDIF
		ENDIF
	ELSEIF (IORDER.EQ.9) THEN
		IF (DIFF.EQ.0) THEN
			IF (INDX.EQ.0) THEN
				REF1D = -((-1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)*(-1.0d0 + 9*x)* &
								(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/(2.293760d0*10.0d0**6)
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (81.0d0*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)* &
								(-1.0d0 + 9*x)*(1.0d0 + 9*x)*(5 + 9*x))/(2.293760d0*10.0d0**6)
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (-81.0d0*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)* &
								(-1.0d0 + 9*x)*(1.0d0 + 9*x)*(7 + 9*x))/573440.0d0
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (9*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)*(-1.0d0 + 9*x)* &
								(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/81920.0d0
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (-81.0d0*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)* &
								(-1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/163840.0d0
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (81.0d0*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)* &
								(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/163840.0d0
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-9*(-1.0d0 + x)*(1.0d0 + x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)*(-1.0d0 + 9*x)* &
								(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/81920.0d0
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (81.0d0*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)* &
								(-1.0d0 + 9*x)*(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/573440.0d0
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (-81.0d0*(-1.0d0 + x)*(1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-5 + 9*x)* &
								(-1.0d0 + 9*x)*(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/(2.293760d0*10.0d0**6)
			ELSEIF (INDX.EQ.9) THEN
				REF1D = ((1.0d0 + x)*(-1.0d0 + 3*x)*(1.0d0 + 3*x)*(-7 + 9*x)*(-5 + 9*x)*(-1.0d0 + 9*x)* &
								(1.0d0 + 9*x)*(5 + 9*x)*(7 + 9*x))/(2.293760d0*10.0d0**6)
			ENDIF
		ELSEIF (DIFF.EQ.1) THEN
			IF (INDX.EQ.0) THEN
				REF1D = (-1225 - 232488*x + 348732*x**2 + 5756184*x**3 - 7195230*x**4 - 29760696*x**5 + &
								34720812*x**6 + 38263752*x**7 - 43046721*x**8)/(2.293760d0*10.0d0**6)
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (81.0d0*(225 + 32984*x - 63612*x**2 - 779688*x**3 + 1253070*x**4 + 3551688*x**5 - &
								5327532*x**6 - 3306744*x**7 + 4782969*x**8))/(2.293760d0*10.0d0**6)
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (-81.0d0*(441 + 45400*x - 122580*x**2 - 950040*x**3 + 2137590*x**4 + 3061800*x**5 - &
								6429780*x**6 - 2361960*x**7 + 4782969*x**8))/573440.0d0
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (9*(3675 + 212888*x - 957996*x**2 - 2389176*x**3 + 8959410*x**4 + 6141096*x**5 - &
								21493836*x**6 - 4251528*x**7 + 14348907*x**8))/81920.0d0
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (-81.0d0*(11025 + 36488*x - 492588*x**2 - 310104*x**3 + 3488670*x**4 + 717336*x**5 - &
								7532028*x**6 - 472392*x**7 + 4782969*x**8))/163840.0d0
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (81.0d0*(11025 - 36488*x - 492588*x**2 + 310104*x**3 + 3488670*x**4 - 717336*x**5 - &
								7532028*x**6 + 472392*x**7 + 4782969*x**8))/163840.0d0
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-9*(3675 - 212888*x - 957996*x**2 + 2389176*x**3 + 8959410*x**4 - 6141096*x**5 - &
								21493836*x**6 + 4251528*x**7 + 14348907*x**8))/81920.0d0
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (81.0d0*(441 - 45400*x - 122580*x**2 + 950040*x**3 + 2137590*x**4 - 3061800*x**5 - &
								6429780*x**6 + 2361960*x**7 + 4782969*x**8))/573440.0d0
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (-81.0d0*(225 - 32984*x - 63612*x**2 + 779688*x**3 + 1253070*x**4 - 3551688*x**5 - &
								5327532*x**6 + 3306744*x**7 + 4782969*x**8))/(2.293760d0*10.0d0**6)
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (1225 - 232488*x - 348732*x**2 + 5756184*x**3 + 7195230*x**4 - 29760696*x**5 - &
								34720812*x**6 + 38263752*x**7 + 43046721*x**8)/(2.293760d0*10.0d0**6)
			ENDIF
		ELSEIF (DIFF.EQ.2) THEN
			IF (INDX.EQ.0) THEN
				REF1D = (-9*(3229 - 9687*x - 239841*x**2 + 399735*x**3 + 2066715*x**4 - 2893401*x**5 - &
								3720087*x**6 + 4782969*x**7))/286720.0d0
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (81.0d0*(4123 - 15903*x - 292383*x**2 + 626535*x**3 + 2219805*x**4 - &
								3995649*x**5 - 2893401*x**6 + 4782969*x**7))/286720.0d0
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (-81.0d0*(5675 - 30645*x - 356265*x**2 + 1068795*x**3 + 1913625*x**4 - &
								4822335*x**5 - 2066715*x**6 + 4782969*x**7))/71680.0d0
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (9*(26611 - 239499*x - 895941*x**2 + 4479705*x**3 + 3838185*x**4 - &
								16120377*x**5 - 3720087*x**6 + 14348907*x**7))/10240.0d0
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (-81.0d0*(4561 - 123147*x - 116289*x**2 + 1744335*x**3 + 448335*x**4 - &
								5649021*x**5 - 413343*x**6 + 4782969*x**7))/20480.0d0
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (81.0d0*(-4561 - 123147*x + 116289*x**2 + 1744335*x**3 - 448335*x**4 - &
								5649021*x**5 + 413343*x**6 + 4782969*x**7))/20480.0d0
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-9*(-26611 - 239499*x + 895941*x**2 + 4479705*x**3 - 3838185*x**4 - &
								16120377*x**5 + 3720087*x**6 + 14348907*x**7))/10240.0d0
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (81.0d0*(-5675 - 30645*x + 356265*x**2 + 1068795*x**3 - 1913625*x**4 - &
								4822335*x**5 + 2066715*x**6 + 4782969*x**7))/71680.0d0
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (-81.0d0*(-4123 - 15903*x + 292383*x**2 + 626535*x**3 - 2219805*x**4 - &
								3995649*x**5 + 2893401*x**6 + 4782969*x**7))/286720.0d0
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (9*(-3229 - 9687*x + 239841*x**2 + 399735*x**3 - 2066715*x**4 - 2893401*x**5 + &
								3720087*x**6 + 4782969*x**7))/286720.0d0
			ENDIF
		ENDIF
	ELSEIF(IORDER.EQ.10)THEN
		IF(DIFF.EQ.0)THEN
			IF(INDX.EQ.0)THEN
				REF1D=((-1+X)*X*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/145152.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-25*(-1+X)*X*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)&
				*(1+5*X)*(2+5*X)*(3+5*X))/72576.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(25*(-1+X)*X*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)&
				*(1+5*X)*(2+5*X)*(4+5*X))/16128.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-25*(-1+X)*X*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)&
				*(1+5*X)*(3+5*X)*(4+5*X))/6048.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(25*(-1+X)*X*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/3456.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=-((-1+X)*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/576.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(25*(-1+X)*X*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/3456.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=(-25*(-1+X)*X*(1+X)*(-4+5*X)*(-3+5*X)*(-1+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/6048.0D0
			ELSEIF(INDX.EQ.8)THEN
				REF1D=(25*(-1+X)*X*(1+X)*(-4+5*X)*(-2+5*X)*(-1+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/16128.0D0
			ELSEIF(INDX.EQ.9)THEN
				REF1D=(-25*(-1+X)*X*(1+X)*(-3+5*X)*(-2+5*X)*(-1+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/72576.0D0
			ELSEIF(INDX.EQ.10)THEN
				REF1D=(X*(1+X)*(-4+5*X)*(-3+5*X)*(-2+5*X)*(-1+5*X)*(1+5*X)&
				*(2+5*X)*(3+5*X)*(4+5*X))/145152.0D0
			ENDIF
		ELSEIF(DIFF.EQ.1)THEN
			IF(INDX.EQ.0)THEN
				REF1D=(-576+1152*X+61500*X**2-82000*X**3-853125*X**4+1023750*X**5 &
				+3281250*X**6-3750000*X**7-3515625*X**8+3906250*X**9)/145152.0D0
			ELSEIF(INDX.EQ.1)THEN
				REF1D=(-25*(-72+180*X+7566*X**2-12610*X**3-99750*X**4+149625*X**5&
				+341250*X**6-487500*X**7-281250*X**8+390625*X**9))/36288.0D0
			ELSEIF(INDX.EQ.2)THEN
				REF1D=(25*(-192+640*X+19476*X**2-43280*X**3-228375*X**4+456750*X**5&
				+603750*X**6-1150000*X**7-421875*X**8+781250*X**9))/16128.0D0
			ELSEIF(INDX.EQ.3)THEN
				REF1D=(-25*(-144+720*X+13107*X**2-43690*X**3-102375*X**4+307125*X**5&
				+223125*X**6-637500*X**7-140625*X**8+390625*X**9))/3024.0D0
			ELSEIF(INDX.EQ.4)THEN
				REF1D=(25*(-576+5760*X+20028*X**2-133520*X**3-121125*X**4+726750*X**5&
				+236250*X**6-1350000*X**7 &
				-140625*X**8+781250*X**9))/3456.0D0
			ELSEIF(INDX.EQ.5)THEN
				REF1D=(-21076*X+382250*X**3-1918125*X**5+3437500*X**7-1953125*X**9)/288.0D0
			ELSEIF(INDX.EQ.6)THEN
				REF1D=(25*(576+5760*X-20028*X**2-133520*X**3+121125*X**4+726750*X**5&
				-236250*X**6-1350000*X**7 &
				+140625*X**8+781250*X**9))/3456.0D0
			ELSEIF(INDX.EQ.7)THEN
				REF1D=(-25*(144+720*X-13107*X**2-43690*X**3+102375*X**4+307125*X**5&
				-223125*X**6-637500*X**7 &
				+140625*X**8+390625*X**9))/3024.0D0
			ELSEIF(INDX.EQ.8)THEN
				REF1D=(25*(192+640*X-19476*X**2-43280*X**3+228375*X**4+456750*X**5&
				-603750*X**6-1150000*X**7 &
				+421875*X**8+781250*X**9))/16128.0D0
			ELSEIF(INDX.EQ.9)THEN
				REF1D=(-25*(72+180*X-7566*X**2-12610*X**3+99750*X**4+149625*X**5&
				-341250*X**6-487500*X**7 &
				+281250*X**8+390625*X**9))/36288.0D0
			ELSEIF(INDX.EQ.10)THEN
				REF1D=(576+1152*X-61500*X**2-82000*X**3+853125*X**4+1023750*X**5&
				-3281250*X**6-3750000*X**7 &
				+3515625*X**8+3906250*X**9)/145152.0D0
			ENDIF
		ELSEIF(DIFF.EQ.2) THEN
			IF(INDX.EQ.0) THEN
				REF1D = (192.D0 + 20500*X - 41000*X**2 - 568750*X**3 + 853125*X**4 + 3281250*X**5 - &
									4375000*X**6 - 4687500*X**7 + 5859375*X**8)/24192.D0
			ELSEIF(INDX.EQ.1) THEN
				REF1D = (-25.D0*(60.D0 + 5044*X - 12610*X**2 - 133000*X**3 + 249375*X**4 + 682500*X**5 - &
									1137500*X**6 - 750000*X**7 + 1171875*X**8))/12096.D0
			ELSEIF(INDX.EQ.2) THEN
				REF1D = (25.D0*(320.D0 + 19476*X - 64920*X**2 - 456750*X**3 + 1141875*X**4 + 1811250*X**5 - &
									4025000*X**6 - 1687500*X**7 + 3515625*X**8))/8064.D0
			ELSEIF(INDX.EQ.3) THEN
				REF1D = (-25.D0*(240.D0 + 8738*X - 43690*X**2 - 136500*X**3 + 511875*X**4 + 446250*X**5 - &
									1487500*X**6 - 375000*X**7 + 1171875*X**8))/1008.D0
			ELSEIF(INDX.EQ.4) THEN
				REF1D = (25.D0*(960.D0 + 6676*X - 66760*X**2 - 80750*X**3 + 605625*X**4 + 236250*X**5 - &
									1575000*X**6 - 187500*X**7 + 1171875*X**8))/576.D0
			ELSEIF(INDX.EQ.5) THEN
				REF1D = (-21076.D0 + 1146750*X**2 - 9590625*X**4 + 24062500*X**6 - 17578125*X**8)/288.D0
			ELSEIF(INDX.EQ.6) THEN
				REF1D = (25.D0*(960.D0 - 6676*X - 66760*X**2 + 80750*X**3 + 605625*X**4 - 236250*X**5 - &
									1575000*X**6 + 187500*X**7 + 1171875*X**8))/576.D0
			ELSEIF(INDX.EQ.7) THEN
				REF1D = (-25.D0*(240.D0 - 8738*X - 43690*X**2 + 136500*X**3 + 511875*X**4 - 446250*X**5 - &
									1487500*X**6 + 375000*X**7 + 1171875*X**8))/1008.D0
			ELSEIF(INDX.EQ.8) THEN
				REF1D = (25.D0*(320.D0 - 19476*X - 64920*X**2 + 456750*X**3 + 1141875*X**4 - 1811250*X**5 - &
									4025000*X**6 + 1687500*X**7 + 3515625*X**8))/8064.D0
			ELSEIF(INDX.EQ.9) THEN
				REF1D = (-25.D0*(60.D0 - 5044*X - 12610*X**2 + 133000*X**3 + 249375*X**4 - 682500*X**5 - &
									1137500*X**6 + 750000*X**7 + 1171875*X**8))/12096.D0
			ELSEIF(INDX.EQ.10) THEN
				REF1D = (192.D0 - 20500*X - 41000*X**2 + 568750*X**3 + 853125*X**4 - 3281250*X**5 - &
									4375000*X**6 + 4687500*X**7 + 5859375*X**8)/24192.D0
			ENDIF
		ENDIF
	ELSEIF (IORDER.EQ.11) THEN
		IF (DIFF.EQ.0) THEN
			IF (INDX.EQ.0) THEN
				REF1D = -((-1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)*(1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(7.43178240d0*10.0d0**9)
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)* &
								(1 + 11*x)*(3 + 11*x)*(5 + 11*x)*(7 + 11*x))/(7.43178240d0*10.0d0**9)
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (-121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)* &
								(1 + 11*x)*(3 + 11*x)*(5 + 11*x)*(9 + 11*x))/(1.486356480d0*10.0d0**9)
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)* &
								(1 + 11*x)*(3 + 11*x)*(7 + 11*x)*(9 + 11*x))/(4.95452160d0*10.0d0**8)
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (-121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)* &
								(1 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(2.47726080d0*10.0d0**8)
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(1.7694720d0*10.0d0**8)
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(1.7694720d0*10.0d0**8)
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-1 + 11*x)*(1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(2.47726080d0*10.0d0**8)
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (-121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-3 + 11*x)*(-1 + 11*x)*(1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(4.95452160d0*10.0d0**8)
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (121.0d0*(-1 + x)*(1 + x)*(-9 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)*(1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(1.486356480d0*10.0d0**9)
			ELSEIF (INDX.EQ.10) THEN
				REF1D = (-121.0d0*(-1 + x)*(1 + x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)*(1 + 11*x)* &
								(3 + 11*x)*(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(7.43178240d0*10.0d0**9)
			ELSEIF (INDX.EQ.11) THEN
				REF1D = ((1 + x)*(-9 + 11*x)*(-7 + 11*x)*(-5 + 11*x)*(-3 + 11*x)*(-1 + 11*x)*(1 + 11*x)*(3 + 11*x)* &
								(5 + 11*x)*(7 + 11*x)*(9 + 11*x))/(7.43178240d0*10.0d0**9)
			ENDIF
		ELSEIF (DIFF.EQ.1) THEN
			IF (INDX.EQ.0) THEN
				REF1D = (893025.0d0 + 255847482.0d0*x - 383771223.0d0*x**2 - 10120444840.0d0*x**3 + &
12650556050.0d0*x**4 + 93304574748.0d0*x**5 - &
								108855337206.0d0*x**6 - 282953722920.0d0*x**7 + 318322938285.0d0*x**8 + 259374246010.0d0*x**9 - &
								285311670611.0d0*x**10)/(7.43178240d0*10.0d0**9)
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (121.0d0*(-121275.0d0 - 28329498.0d0*x + 51937413.0d0*x**2 + 1096710120.0d0*x**3 - &
1675529350.0d0*x**4 - 9596472732.0d0*x**5 + &
								13683859266.0d0*x**6 + 26148240360.0d0*x**7 - 35953830495.0d0*x**8 - 19292299290.0d0*x**9 + &
								25937424601.0d0*x**10))/(7.43178240d0*10.0d0**9)
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (-121.0d0*(-200475 - 36174726.0d0*x + 85268997.0d0*x**2 + 1340218264.0d0*x**3 - &
2632571590.0d0*x**4 - 10533613860.0d0*x**5 + &
								19311625410.0d0*x**6 + 23512157592.0d0*x**7 - 41566135743.0d0*x**8 - 15005121670.0d0*x**9 + &
								25937424601.0d0*x**10))/(1.486356480d0*10.0d0**9)
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (121.0d0*(-392931.0d0 - 49797810.0d0*x + 164332773.0d0*x**2 + 1644385160.0d0*x**3 - &
4522059190.0d0*x**4 - 9758812140.0d0*x**5 + &
								25047617826.0d0*x**6 + 18495096840.0d0*x**7 - 45775364679.0d0*x**8 - 10717944050.0d0*x**9 + &
								25937424601.0d0*x**10))/(4.95452160d0*10.0d0**8)
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (-121.0d0*(-1091475.0d0 - 77873694.0d0*x + 428305317.0d0*x**2 + 1450109496.0d0*x**3 - &
6646335190.0d0*x**4 - 6917872500.0d0*x**5 + &
								29593121250.0d0*x**6 + 11777337528.0d0*x**7 - 48581517303.0d0*x**8 - 6430766430.0d0*x**9 + &
								25937424601.0d0*x**10))/(2.47726080d0*10.0d0**8)
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (121.0d0*(-9823275.0d0 - 41521482.0d0*x + 685104453.0d0*x**2 + 583941160.0d0*x**3 - &
8029190950.0d0*x**4 - 2499921468.0d0*x**5 + &
								32082325506.0d0*x**6 + 4039159080.0d0*x**7 - 49984593615.0d0*x**8 - 2143588810.0d0*x**9 + &
								25937424601.0d0*x**10))/(1.7694720d0*10.0d0**8)
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-121.0d0*(-9823275.0d0 + 41521482.0d0*x + 685104453.0d0*x**2 - 583941160.0d0*x**3 - &
8029190950.0d0*x**4 + 2499921468.0d0*x**5 + &
								32082325506.0d0*x**6 - 4039159080.0d0*x**7 - 49984593615.0d0*x**8 + 2143588810.0d0*x**9 + &
								25937424601.0d0*x**10))/(1.7694720d0*10.0d0**8)
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (121.0d0*(-1091475.0d0 + 77873694.0d0*x + 428305317.0d0*x**2 - 1450109496.0d0*x**3 - &
6646335190.0d0*x**4 + 6917872500.0d0*x**5 + &
								29593121250.0d0*x**6 - 11777337528.0d0*x**7 - 48581517303.0d0*x**8 + 6430766430.0d0*x**9 + &
								25937424601.0d0*x**10))/(2.47726080d0*10.0d0**8)
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (-121.0d0*(-392931 + 49797810.0d0*x + 164332773.0d0*x**2 - 1644385160.0d0*x**3 - &
4522059190.0d0*x**4 + 9758812140.0d0*x**5 + &
								25047617826.0d0*x**6 - 18495096840.0d0*x**7 - 45775364679.0d0*x**8 + 10717944050.0d0*x**9 + &
								25937424601.0d0*x**10))/(4.95452160d0*10.0d0**8)
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (121.0d0*(-200475 + 36174726.0d0*x + 85268997.0d0*x**2 - 1340218264.0d0*x**3 - &
2632571590.0d0*x**4 + 10533613860.0d0*x**5 + &
								19311625410.0d0*x**6 - 23512157592.0d0*x**7 - 41566135743.0d0*x**8 + 15005121670.0d0*x**9 + &
								25937424601.0d0*x**10))/(1.486356480d0*10.0d0**9)
			ELSEIF (INDX.EQ.10) THEN
				REF1D = (-121.0d0*(-121275.0d0 + 28329498.0d0*x + 51937413.0d0*x**2 - 1096710120.0d0*x**3 - &
1675529350.0d0*x**4 + 9596472732.0d0*x**5 + &
								13683859266.0d0*x**6 - 26148240360.0d0*x**7 - 35953830495.0d0*x**8 + 19292299290.0d0*x**9 + &
								25937424601.0d0*x**10))/(7.43178240d0*10.0d0**9)
			ELSEIF (INDX.EQ.11) THEN
				REF1D = (-893025.0d0 + 255847482.0d0*x + 383771223.0d0*x**2 - 10120444840.0d0*x**3 - &
12650556050.0d0*x**4 + 93304574748.0d0*x**5 + &
								108855337206.0d0*x**6 - 282953722920.0d0*x**7 - 318322938285.0d0*x**8 + 259374246010.0d0*x**9 + &
								285311670611.0d0*x**10)/(7.43178240d0*10.0d0**9)
			ENDIF
		ELSEIF (DIFF.EQ.2) THEN
			IF (INDX.EQ.0) THEN
				REF1D = (-1331.0d0*(-96111.0d0 + 288333.0d0*x + 11405460.0d0*x**2 - 19009100.0d0*x**3 - &
175252770.0d0*x**4 + 245353878.0d0*x**5 + &
								744055620.0d0*x**6 - 956642940.0d0*x**7 - 876922695.0d0*x**8 + 1071794405.0d0*x**9))/(3.71589120d0*10.0d0**9)
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (121.0d0*(-14164749.0d0 + 51937413.0d0*x + 1645065180.0d0*x**2 - 3351058700.0d0*x**3 - &
23991181830.0d0*x**4 + 41051577798.0d0*x**5 + &
								91518841260.0d0*x**6 - 143815321980.0d0*x**7 - 86815346805.0d0*x**8 + &
129687123005.0d0*x**9))/(3.71589120d0*10.0d0**9)
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (-121.0d0*(-18087363.0d0 + 85268997.0d0*x + 2010327396.0d0*x**2 - 5265143180.0d0*x**3 - &
26334034650.0d0*x**4 + 57934876230.0d0*x**5 + &
								82292551572.0d0*x**6 - 166264542972.0d0*x**7 - 67523047515.0d0*x**8 + &
129687123005.0d0*x**9))/(7.43178240d0*10.0d0**8)
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (121.0d0*(-24898905.0d0 + 164332773.0d0*x + 2466577740.0d0*x**2 - 9044118380.0d0*x**3 - &
24397030350.0d0*x**4 + 75142853478.0d0*x**5 + &
								64732838940.0d0*x**6 - 183101458716.0d0*x**7 - 48230748225.0d0*x**8 + &
129687123005.0d0*x**9))/(2.47726080d0*10.0d0**8)
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (-121.0d0*(-38936847.0d0 + 428305317.0d0*x + 2175164244.0d0*x**2 - 13292670380.0d0*x**3 - &
17294681250.0d0*x**4 + 88779363750.0d0*x**5 + &
								41220681348.0d0*x**6 - 194326069212.0d0*x**7 - 28938448935.0d0*x**8 + &
129687123005.0d0*x**9))/(1.23863040d0*10.0d0**8)
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (121.0d0*(-20760741.0d0 + 685104453.0d0*x + 875911740.0d0*x**2 - 16058381900.0d0*x**3 - &
6249803670.0d0*x**4 + 96246976518.0d0*x**5 + &
								14137056780.0d0*x**6 - 199938374460.0d0*x**7 - 9646149645.0d0*x**8 + &
129687123005.0d0*x**9))/(8.847360d0*10.0d0**7)
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-121.0d0*(20760741.0d0 + 685104453.0d0*x - 875911740.0d0*x**2 - 16058381900.0d0*x**3 + &
6249803670.0d0*x**4 + 96246976518.0d0*x**5 - &
								14137056780.0d0*x**6 - 199938374460.0d0*x**7 + 9646149645.0d0*x**8 + &
129687123005.0d0*x**9))/(8.847360d0*10.0d0**7)
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (121.0d0*(38936847.0d0 + 428305317.0d0*x - 2175164244.0d0*x**2 - 13292670380.0d0*x**3 + &
17294681250.0d0*x**4 + 88779363750.0d0*x**5 - &
								41220681348.0d0*x**6 - 194326069212.0d0*x**7 + 28938448935.0d0*x**8 + &
129687123005.0d0*x**9))/(1.23863040d0*10.0d0**8)
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (-121.0d0*(24898905 + 164332773.0d0*x - 2466577740.0d0*x**2 - 9044118380.0d0*x**3 + &
24397030350.0d0*x**4 + 75142853478.0d0*x**5 - &
								64732838940.0d0*x**6 - 183101458716.0d0*x**7 + 48230748225.0d0*x**8 + &
129687123005.0d0*x**9))/(2.47726080d0*10.0d0**8)
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (121.0d0*(18087363.0d0 + 85268997.0d0*x - 2010327396.0d0*x**2 - 5265143180.0d0*x**3 + &
26334034650.0d0*x**4 + 57934876230.0d0*x**5 - &
								82292551572.0d0*x**6 - 166264542972.0d0*x**7 + 67523047515.0d0*x**8 + &
129687123005.0d0*x**9))/(7.43178240d0*10.0d0**8)
			ELSEIF (INDX.EQ.10) THEN
				REF1D = (-121.0d0*(14164749.0d0 + 51937413.0d0*x - 1645065180.0d0*x**2 - 3351058700.0d0*x**3 + &
23991181830.0d0*x**4 + 41051577798.0d0*x**5 - &
								91518841260.0d0*x**6 - 143815321980.0d0*x**7 + 86815346805.0d0*x**8 + &
129687123005.0d0*x**9))/(3.71589120d0*10.0d0**9)
			ELSEIF (INDX.EQ.11) THEN
				REF1D = (1331.0d0*(96111 + 288333.0d0*x - 11405460.0d0*x**2 - 19009100.0d0*x**3 + &
175252770.0d0*x**4 + 245353878.0d0*x**5 - 744055620.0d0*x**6 - &
								956642940.0d0*x**7 + 876922695.0d0*x**8 + &
1071794405.0d0*x**9))/(3.71589120d0*10.0d0**9)
			ENDIF
		ENDIF
	ELSEIF (IORDER.EQ.12) THEN
		IF (DIFF.EQ.0) THEN
			IF (INDX.EQ.0) THEN
				REF1D = ((-1.0d0 + X)*X*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/92400.D0
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (-3*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*&
									(1.0d0 + 3*X)*(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X))/3850.D0
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (3*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*&
									(1.0d0 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/1400.D0
			ELSEIF (INDX.EQ.3) THEN
				REF1D = -((-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/210.D0
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (9*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/560.D0
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (-9*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*&
									(1.0d0 + 3*X)*(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(5 + 6*X))/175.D0
			ELSEIF (INDX.EQ.6) THEN
				REF1D = ((-1.0d0 + X)*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/100.D0
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (-9*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*&
									(1.0d0 + 3*X)*(2 + 3*X)*(-5 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/175.D0
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (9*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/560.D0
			ELSEIF (INDX.EQ.9) THEN
				REF1D = -((-1.0d0 + X)*X*(1.0d0 + X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/210.D0
			ELSEIF (INDX.EQ.10) THEN
				REF1D = (3*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-1.0d0 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/1400.D0
			ELSEIF (INDX.EQ.11) THEN
				REF1D = (-3*(-1.0d0 + X)*X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*&
									(1.0d0 + 3*X)*(2 + 3*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/3850.D0
			ELSEIF (INDX.EQ.12) THEN
				REF1D = (X*(1.0d0 + X)*(-1.0d0 + 2*X)*(1.0d0 + 2*X)*(-2 + 3*X)*(-1.0d0 + 3*X)*(1.0d0 + 3*X)*&
									(2 + 3*X)*(-5 + 6*X)*(-1.0d0 + 6*X)*(1.0d0 + 6*X)*(5 + 6*X))/92400.D0
			ENDIF
		ELSEIF (DIFF.EQ.1) THEN
			IF (INDX.EQ.0) THEN
				REF1D = (100.D0 - 200*X - 15807*X**2 + 21076*X**3 + 344025*X**4 - 412830*X**5 - 2320164*X**6 + &
									2651616*X**7 + 5773680*X**8 - 6415200*X**9 - 4618944*X**10 + 5038848*X**11)/92400.D0
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (-3.D0*(20.D0 - 48*X - 3135*X**2 + 5016*X**3 + 66550*X**4 - 95832*X**5 - 426195*X**6 + &
									584496*X**7 + 962280*X**8 - 1283040*X**9 - 641520*X**10 + 839808*X**11))/3850.D0
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (3.D0*(25.D0 - 75*X - 3858*X**2 + 7716*X**3 + 78125*X**4 - 140625*X**5 - 454356*X**6 + &
									778896*X**7 + 874800*X**8 - 1458000*X**9 - 513216*X**10 + 839808*X**11))/700.D0
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (-100.D0 + 400*X + 14907*X**2 - 39752*X**3 - 270990*X**4 + 650376*X**5 + 1284255*X**6 - &
									2935440*X**7 - 2152008*X**8 + 4782240*X**9 + 1154736*X**10 - 2519424*X**11)/210.D0
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (9.D0*(100.D0 - 600*X - 13407*X**2 + 53628*X**3 + 169265*X**4 - 609354*X**5 - 669060*X**6 + &
									2293920*X**7 + 1014768*X**8 - 3382560*X**9 - 513216*X**10 + 1679616*X**11))/560.D0
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (-9.D0*(100.D0 - 1200*X - 5307*X**2 + 42456*X**3 + 51950*X**4 - 374040*X**5 - 183519*X**6 + &
									1258416*X**7 + 262440*X**8 - 1749600*X**9 - 128304*X**10 + 839808*X**11))/175.D0
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (X*(-5369.D0 + 148148*X**2 - 1200771*X**4 + 3891888*X**6 - 5307120*X**8 + 2519424*X**10))/50.D0
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (-9.D0*(-100.D0 - 1200*X + 5307*X**2 + 42456*X**3 - 51950*X**4 - 374040*X**5 + 183519*X**6 + &
									1258416*X**7 - 262440*X**8 - 1749600*X**9 + 128304*X**10 + 839808*X**11))/175.D0
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (9.D0*(-100.D0 - 600*X + 13407*X**2 + 53628*X**3 - 169265*X**4 - 609354*X**5 + 669060*X**6 + &
									2293920*X**7 - 1014768*X**8 - 3382560*X**9 + 513216*X**10 + 1679616*X**11))/560.D0
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (100.D0 + 400*X - 14907*X**2 - 39752*X**3 + 270990*X**4 + 650376*X**5 - 1284255*X**6 - &
									2935440*X**7 + 2152008*X**8 + 4782240*X**9 - 1154736*X**10 - 2519424*X**11)/210.D0
			ELSEIF (INDX.EQ.10) THEN
				REF1D = (3.D0*(-25.D0 - 75*X + 3858*X**2 + 7716*X**3 - 78125*X**4 - 140625*X**5 + 454356*X**6 + &
									778896*X**7 - 874800*X**8 - 1458000*X**9 + 513216*X**10 + 839808*X**11))/700.D0
			ELSEIF (INDX.EQ.11) THEN
				REF1D = (-3.D0*(-20.D0 - 48*X + 3135*X**2 + 5016*X**3 - 66550*X**4 - 95832*X**5 + 426195*X**6 + &
									584496*X**7 - 962280*X**8 - 1283040*X**9 + 641520*X**10 + 839808*X**11))/3850.D0
			ELSEIF (INDX.EQ.12) THEN
				REF1D = (-100.D0 - 200*X + 15807*X**2 + 21076*X**3 - 344025*X**4 - 412830*X**5 + 2320164*X**6 + &
									2651616*X**7 - 5773680*X**8 - 6415200*X**9 + 4618944*X**10 + 5038848*X**11)/92400.D0
			ENDIF
		ELSEIF (DIFF.EQ.2) THEN
			IF (INDX.EQ.0) THEN
				REF1D = -0.00216450216450216450D0 - (479*X)/1400.D0 + (479*X**2)/700.D0 + (417*X**3)/28.D0 - (1251*X**4)/56.D0 - &
								(7533*X**5)/50.D0 + (5022*X**6)/25.D0 + (17496*X**7)/35.D0 - (4374*X**8)/7.D0 - (17496*X**9)/35.D0 + (104976*X**10)/175.D0
			ELSEIF (INDX.EQ.1) THEN
				REF1D = (-3.D0*(-24.D0 - 3135*X + 7524*X**2 + 133100*X**3 - 239580*X**4 - 1278585*X**5 + 2045736*X**6 + &
								3849120*X**7 - 5773680*X**8 - 3207600*X**9 + 4618944*X**10))/1925.D0
			ELSEIF (INDX.EQ.2) THEN
				REF1D = (3.D0*(-75.D0 - 7716*X + 23148*X**2 + 312500*X**3 - 703125*X**4 - 2726136*X**5 + 5452272*X**6 + &
								6998400*X**7 - 13122000*X**8 - 5132160*X**9 + 9237888*X**10))/700.D0
			ELSEIF (INDX.EQ.3) THEN
				REF1D = (200.D0 + 14907*X - 59628*X**2 - 541980*X**3 + 1625940*X**4 + 3852765*X**5 - 10274040*X**6 - &
								8608032*X**7 + 21520080*X**8 + 5773680*X**9 - 13856832*X**10)/105.D0
			ELSEIF (INDX.EQ.4) THEN
				REF1D = (9.D0*(-300.D0 - 13407*X + 80442*X**2 + 338530*X**3 - 1523385*X**4 - 2007180*X**5 + 8028720*X**6 + &
								4059072*X**7 - 15221520*X**8 - 2566080*X**9 + 9237888*X**10))/280.D0
			ELSEIF (INDX.EQ.5) THEN
				REF1D = (-18.D0*(-600.D0 - 5307*X + 63684*X**2 + 103900*X**3 - 935100*X**4 - 550557*X**5 + 4404456*X**6 + &
								1049760*X**7 - 7873200*X**8 - 641520*X**9 + 4618944*X**10))/175.D0
			ELSEIF (INDX.EQ.6) THEN
				REF1D = (-5369.D0 + 444444.D0*X**2 - 6003855*X**4 + 27243216*X**6 - 47764080*X**8 + 27713664*X**10)/50.D0
			ELSEIF (INDX.EQ.7) THEN
				REF1D = (-18.D0*(-600.D0 + 5307*X + 63684*X**2 - 103900*X**3 - 935100*X**4 + 550557*X**5 + 4404456*X**6 - &
								1049760*X**7 - 7873200*X**8 + 641520*X**9 + 4618944*X**10))/175.D0
			ELSEIF (INDX.EQ.8) THEN
				REF1D = (9.D0*(-300.D0 + 13407*X + 80442*X**2 - 338530*X**3 - 1523385*X**4 + 2007180*X**5 + 8028720*X**6 - &
								4059072*X**7 - 15221520*X**8 + 2566080*X**9 + 9237888*X**10))/280.D0
			ELSEIF (INDX.EQ.9) THEN
				REF1D = (200.D0 - 14907*X - 59628*X**2 + 541980*X**3 + 1625940*X**4 - 3852765*X**5 - 10274040*X**6 + &
								8608032*X**7 + 21520080*X**8 - 5773680*X**9 - 13856832*X**10)/105.D0
			ELSEIF (INDX.EQ.10) THEN
				REF1D = (3.D0*(-75.D0 + 7716*X + 23148*X**2 - 312500*X**3 - 703125*X**4 + 2726136*X**5 + 5452272*X**6 - &
								6998400*X**7 - 13122000*X**8 + 5132160*X**9 + 9237888*X**10))/700.D0
			ELSEIF (INDX.EQ.11) THEN
				REF1D = (-3.D0*(-24.D0 + 3135*X + 7524*X**2 - 133100*X**3 - 239580*X**4 + 1278585*X**5 + 2045736*X**6 - &
								3849120*X**7 - 5773680*X**8 + 3207600*X**9 + 4618944*X**10))/1925.D0
			ELSEIF (INDX.EQ.12) THEN
				REF1D = -0.00216450216450216450D0 + (479*X)/1400.D0 + (479*X**2)/700.D0 - (417*X**3)/28.D0 - (1251*X**4)/56.D0 + &
								(7533*X**5)/50.D0 + (5022*X**6)/25.D0 - (17496*X**7)/35.D0 - (4374*X**8)/7.D0 + &
								(17496*X**9)/35.D0 + (104976*X**10)/175.D0
			ENDIF
		ENDIF
! 	ELSEIF (IORDER.EQ.14) THEN
! 		IF (DIFF.EQ.0) THEN
! 			IF (INDX.EQ.0) THEN
! 				REF1D = ((-1.0d0 + X)*X*(-6 + 7*X)*(-5 + 7*X)*(-4 + 7*X)*(-3 + 7*X)*(-2 + 7*X)*(-1.0d0 + 7*X)*(1.0d0 + 7*X)*(2 + 7*X)*(3 + 7*X)*(4 + 7*X)*(5 + 7*X)*(6 + 7*X))/1.7791488E9
! 			ELSEIF (INDX.EQ.1) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.2) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.3) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.4) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.5) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.6) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.7) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.8) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.9) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.10) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.11) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.12) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.13) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.14) THEN
! 				REF1D = 
! 			ENDIF
! 		ELSEIF (DIFF.EQ.1) THEN
! 			IF (INDX.EQ.0) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.1) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.2) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.3) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.4) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.5) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.6) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.7) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.8) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.9) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.10) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.11) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.12) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.13) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.14) THEN
! 				REF1D = 
! 			ENDIF
! 		ELSEIF (DIFF.EQ.2) THEN
! 			IF (INDX.EQ.0) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.1) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.2) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.3) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.4) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.5) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.6) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.7) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.8) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.9) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.10) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.11) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.12) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.13) THEN
! 				REF1D = 
! 			ELSEIF (INDX.EQ.14) THEN
! 				REF1D = 
! 			ENDIF
! 		ENDIF
	ENDIF

	111 CONTINUE
	
END FUNCTION REF1D

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

! NURBS PU WITH FLAT-TOP 

TYPE(FUNCTION_1D) FUNCTION GET_LOCBASIS(PHYPT, BSNDX, PATCH)

	REAL*8, INTENT(IN) :: PHYPT
	INTEGER, INTENT(IN) :: BSNDX, PATCH
	
	INTEGER :: I, J, K
	TYPE(FUNCTION_1D) :: REFX
	REAL*8 :: BSD1X, BSD2X
	
	! Check if the given physical point is in the support of the local basis function
	IF (NUMPATCH.NE.1) THEN 
		IF (PATCH==1) THEN
			IF (PHYPT<DOMAIN(1) .OR. PHYPT>(PATCHBDPT(1,2) + DELTA)) THEN 
				GOTO 14
			ENDIF
		ELSEIF (PATCH==NUMPATCH) THEN 
			IF (PHYPT<(PATCHBDPT(NUMPATCH,1) - DELTA) .OR. PHYPT>DOMAIN(2)) THEN 
				GOTO 14
			ENDIF
		ELSE 
			IF (PHYPT<(PATCHBDPT(PATCH,1) - DELTA) .OR. PHYPT>(PATCHBDPT(PATCH,2) + DELTA)) THEN 
				GOTO 14
			ENDIF
		ENDIF
	ENDIF
	
	REFX = PATCH_TO_REF1D(PHYPT, PATCH)
	
	GET_LOCBASIS%VAL(0) = REF1D(REFX%VAL(0), BSNDX, 0)
	GET_LOCBASIS%VAL(1) = REF1D(REFX%VAL(0), BSNDX, 1)*REFX%VAL(1)
	GET_LOCBASIS%VAL(2) = REF1D(REFX%VAL(0), BSNDX, 2)*REFX%VAL(1)**2 + REF1D(REFX%VAL(0), BSNDX, 1)*REFX%VAL(2)
	GOTO 15
	
	14 CONTINUE
	GET_LOCBASIS%VAL(0) = 0.0D0
	GET_LOCBASIS%VAL(1) = 0.0D0
	GET_LOCBASIS%VAL(2) = 0.0D0
	
	15 CONTINUE
	
END FUNCTION GET_LOCBASIS

END MODULE BASIS
